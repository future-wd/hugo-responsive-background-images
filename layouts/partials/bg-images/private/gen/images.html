{{- /*
  bg-images/private/gen/images.html
  Generates original and webp format images based on image and width input.

  @author @sean-au

  @context
    .image
      .src - page resource file string
      .ctx - page context
    .width - resize width integer

  @returns dict:
    .original - original format image
    .webp - webp format image

  @access private

  @example - Hugo Template
  {{- $resized := partial "bg-images/private/generate-images" (dict "image" $image "width" $width) }}

*/ -}}

{{/* temp variable */}}
{{ $c := site.Params.bg_images }}

{{ $img := .image.ctx.Resources.GetMatch .image.src }}
{{ $original := $img.Resize (printf "%vx q%v" .width $c.quality) }}
{{ $jpg := $img.Resize (printf "%vx jpeg q%v" .width $c.quality) }}
{{ $webp := $img.Resize (printf "%vx webp q%v" .width $c.quality) }}
{{ $lqip := false }}
{{ $lqip_webp := false }}
{{ $single := false }}
{{ if eq .image.placeholder "lqip"}}
  {{ $lqip = $img.Resize (printf "%vx jpeg q%v" (div .width 1.5 | int) .image.lqip.quality) }}
  {{ $lqip = $lqip.Filter (images.GaussianBlur .image.lqip.blur) }}
  {{ $lqip = $lqip.RelPermalink }}
  {{ $lqip_webp = $img.Resize (printf "%vx webp q%v" (div .width .image.lqip.div | int) .image.lqip.quality) }}
  {{ $lqip_webp = $lqip_webp.Filter (images.GaussianBlur .image.lqip.blur) }}
  {{ $lqip_webp = $lqip_webp.RelPermalink }}
{{ else if (eq .image.placeholder "dominant") }}
  {{ $single = $img.Resize "1x gif" }}
{{ end }}
{{ return (dict 
  "original" $original 
  "jpg" $jpg
  "webp" $webp 
  "lqip" $lqip 
  "lqip_webp" $lqip_webp 
  "single" $single) }}
